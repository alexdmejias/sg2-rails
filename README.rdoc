port of my sg2 repo to rails